<template>
    <!-- <div> -->
        <div id="app">
            <svg xmlns="http://www.w3.org/2000/svg" v-if="nu!==1" xmlns:xlink="http://www.w3.org/1999/xlink" style="background:#fff" viewBox="0 0 1080 1693"><defs><path id="b" d="M1 0h216v1148H1z"/><filter id="a" width="200%" height="200%" x="-50%" y="-50%" filterUnits="objectBoundingBox"><feOffset dx="1" in="SourceAlpha" result="shadowOffsetOuter1"/><feColorMatrix in="shadowOffsetOuter1" values="0 0 0 0 0.933333333 0 0 0 0 0.933333333 0 0 0 0 0.933333333 0 0 0 1 0"/></filter><path id="d" d="M0 0h215v147.276H0z"/><filter id="c" width="200%" height="200%" x="-50%" y="-50%" filterUnits="objectBoundingBox"><feOffset dy="1" in="SourceAlpha" result="shadowOffsetOuter1"/><feColorMatrix in="shadowOffsetOuter1" values="0 0 0 0 0.933333333 0 0 0 0 0.933333333 0 0 0 0 0.933333333 0 0 0 1 0"/></filter><path id="f" d="M0 0h215v147.276H0z"/><filter id="e" width="200%" height="200%" x="-50%" y="-50%" filterUnits="objectBoundingBox"><feOffset dy="1" in="SourceAlpha" result="shadowOffsetOuter1"/><feColorMatrix in="shadowOffsetOuter1" values="0 0 0 0 0.933333333 0 0 0 0 0.933333333 0 0 0 0 0.933333333 0 0 0 1 0"/></filter><path id="h" d="M0 0h215v147.276H0z"/><filter id="g" width="200%" height="200%" x="-50%" y="-50%" filterUnits="objectBoundingBox"><feOffset dy="1" in="SourceAlpha" result="shadowOffsetOuter1"/><feColorMatrix in="shadowOffsetOuter1" values="0 0 0 0 0.933333333 0 0 0 0 0.933333333 0 0 0 0 0.933333333 0 0 0 1 0"/></filter><path id="j" d="M0 0h215v147.276H0z"/><filter id="i" width="200%" height="200%" x="-50%" y="-50%" filterUnits="objectBoundingBox"><feOffset dy="1" in="SourceAlpha" result="shadowOffsetOuter1"/><feColorMatrix in="shadowOffsetOuter1" values="0 0 0 0 0.933333333 0 0 0 0 0.933333333 0 0 0 0 0.933333333 0 0 0 1 0"/></filter><path id="l" d="M0 0h215v147.276H0z"/><filter id="k" width="200%" height="200%" x="-50%" y="-50%" filterUnits="objectBoundingBox"><feOffset dy="1" in="SourceAlpha" result="shadowOffsetOuter1"/><feColorMatrix in="shadowOffsetOuter1" values="0 0 0 0 0.933333333 0 0 0 0 0.933333333 0 0 0 0 0.933333333 0 0 0 1 0"/></filter><path id="n" d="M0 0h215v147.276H0z"/><filter id="m" width="200%" height="200%" x="-50%" y="-50%" filterUnits="objectBoundingBox"><feOffset dy="1" in="SourceAlpha" result="shadowOffsetOuter1"/><feColorMatrix in="shadowOffsetOuter1" values="0 0 0 0 0.933333333 0 0 0 0 0.933333333 0 0 0 0 0.933333333 0 0 0 1 0"/></filter><rect id="o" width="168" height="158.605" rx="12"/><rect id="p" width="168" height="158.605" rx="12"/><rect id="q" width="168" height="158.605" rx="12"/><rect id="r" width="168" height="158.911" rx="12"/><rect id="s" width="168" height="158.911" rx="12"/><path id="u" d="M0 0h1080v131.04H0z"/><filter id="t" width="200%" height="200%" x="-50%" y="-50%" filterUnits="objectBoundingBox"><feOffset dy="1" in="SourceAlpha" result="shadowOffsetOuter1"/><feColorMatrix in="shadowOffsetOuter1" values="0 0 0 0 0.933333333 0 0 0 0 0.933333333 0 0 0 0 0.933333333 0 0 0 1 0"/></filter><path id="v" d="M0 0h1080v375.8H0z"/></defs><g fill="none" fill-rule="evenodd"><g transform="translate(0 506.84)"><use fill="#000" filter="url(#a)" xlink:href="#b"/><use fill="#F6F6F6" xlink:href="#b"/></g><g transform="translate(1 654.116)"><use fill="#000" filter="url(#c)" xlink:href="#d"/><use fill="#F6F6F6" xlink:href="#d"/></g><path fill="#eee" d="M30 710.761h144v33.987H30z"/><g transform="translate(1 506.84)"><use fill="#000" filter="url(#e)" xlink:href="#f"/><use fill="#F6F6F6" xlink:href="#f"/></g><path fill="#eee" d="M30 563.485h144v33.987H30z"/><g transform="translate(0 801.84)"><use fill="#000" filter="url(#g)" xlink:href="#h"/><use fill="#F6F6F6" xlink:href="#h"/></g><path fill="#eee" d="M29 858.485h144v33.987H29z"/><g><g transform="translate(0 949.84)"><use fill="#000" filter="url(#i)" xlink:href="#j"/><use fill="#F6F6F6" xlink:href="#j"/></g><path fill="#eee" d="M29 1006.485h144v33.987H29z"/></g><g><g transform="translate(0 1097.84)"><use fill="#000" filter="url(#k)" xlink:href="#l"/><use fill="#F6F6F6" xlink:href="#l"/></g><path fill="#eee" d="M29 1154.485h144v33.987H29z"/></g><g><g transform="translate(0 1245.84)"><use fill="#000" filter="url(#m)" xlink:href="#n"/><use fill="#F6F6F6" xlink:href="#n"/></g><path fill="#eee" d="M29 1302.485h144v33.987H29z"/></g><g><path fill="#EEE" d="M249 740.028h833v.944H249z"/><g transform="translate(982 644.676)"><ellipse cx="35" cy="33.043" fill="#eee" rx="35" ry="33.043"/><path fill="#FFF" d="M32.168 30.21H19.825A2.826 2.826 0 0 0 17 33.044a2.83 2.83 0 0 0 2.825 2.832h12.343v12.343A2.826 2.826 0 0 0 35 51.043a2.83 2.83 0 0 0 2.832-2.825V35.875h12.343A2.826 2.826 0 0 0 53 33.043a2.83 2.83 0 0 0-2.825-2.832H37.832V17.868A2.826 2.826 0 0 0 35 15.043a2.83 2.83 0 0 0-2.832 2.825V30.21z"/></g><path fill="#eee" d="M447 659.78h80v39.652h-80zM447 599.36h300v28.322H447z"/><use fill="#eee" transform="translate(249 538.939)" xlink:href="#o"/><path fill="#eee" d="M447 538.939h400v39.65H447z"/><g><path fill="#EEE" d="M249 984.544h833v.944H249z"/><g transform="translate(982 889.192)"><ellipse cx="35" cy="33.043" fill="#eee" rx="35" ry="33.043"/><path fill="#FFF" d="M32.168 30.21H19.825A2.826 2.826 0 0 0 17 33.044a2.83 2.83 0 0 0 2.825 2.832h12.343v12.343A2.826 2.826 0 0 0 35 51.043a2.83 2.83 0 0 0 2.832-2.825V35.875h12.343A2.826 2.826 0 0 0 53 33.043a2.83 2.83 0 0 0-2.825-2.832H37.832V17.868A2.826 2.826 0 0 0 35 15.043a2.83 2.83 0 0 0-2.832 2.825V30.21z"/></g><path fill="#eee" d="M447 904.297h80v39.651h-80zM447 843.876h300v28.322H447z"/><use fill="#eee" transform="translate(249 783.455)" xlink:href="#p"/><path fill="#eee" d="M447 783.455h400v39.651H447z"/></g><g><path fill="#EEE" d="M249 1229.06h833v.945H249z"/><g transform="translate(982 1133.708)"><ellipse cx="35" cy="33.043" fill="#eee" rx="35" ry="33.043"/><path fill="#FFF" d="M32.168 30.21H19.825A2.826 2.826 0 0 0 17 33.044a2.83 2.83 0 0 0 2.825 2.832h12.343v12.343A2.826 2.826 0 0 0 35 51.043a2.83 2.83 0 0 0 2.832-2.825V35.875h12.343A2.826 2.826 0 0 0 53 33.043a2.83 2.83 0 0 0-2.825-2.832H37.832V17.868A2.826 2.826 0 0 0 35 15.043a2.83 2.83 0 0 0-2.832 2.825V30.21z"/></g><path fill="#eee" d="M447 1148.814h80v39.65h-80zM447 1088.393h300v28.322H447z"/><use fill="#eee" transform="translate(249 1027.972)" xlink:href="#q"/><path fill="#eee" d="M447 1027.972h400v39.65H447z"/></g><g><path fill="#EEE" d="M249 1473.964h833v.946H249z"/><g transform="translate(982 1378.429)"><ellipse cx="35" cy="33.106" fill="#eee" rx="35" ry="33.106"/><path fill="#FFF" d="M32.162 30.269H19.84a2.838 2.838 0 1 0 0 5.675h12.322v12.323a2.838 2.838 0 1 0 5.676 0V35.944H50.16a2.838 2.838 0 1 0 0-5.675H37.838V17.946a2.838 2.838 0 1 0-5.676 0V30.27z"/></g><path fill="#eee" d="M447 1393.563h80v39.728h-80zM447 1333.025h300v28.377H447z"/><use fill="#eee" transform="translate(249 1272.488)" xlink:href="#r"/><path fill="#eee" d="M447 1272.488h400v39.728H447z"/></g><g><g transform="translate(982 1607.88)"><ellipse cx="35" cy="33.106" fill="#eee" rx="35" ry="33.106"/><path fill="#FFF" d="M32.162 30.269H19.84a2.838 2.838 0 1 0 0 5.675h12.322v12.323a2.838 2.838 0 1 0 5.676 0V35.944H50.16a2.838 2.838 0 1 0 0-5.675H37.838V17.946a2.838 2.838 0 1 0-5.676 0V30.27z"/></g><path fill="#eee" d="M447 1623.014h80v39.728h-80zM447 1562.476h300v28.377H447z"/><use fill="#eee" transform="translate(249 1501.939)" xlink:href="#s"/><path fill="#eee" d="M447 1501.939h400v39.728H447z"/></g></g><g><g transform="translate(0 375.8)"><use fill="#000" filter="url(#t)" xlink:href="#u"/><use fill="#FFF" xlink:href="#u"/></g><path fill="#eee" d="M246 410.8h94v50h-94zM798 410.8h94v50h-94z"/></g><g><mask id="w" fill="#fff"><use xlink:href="#v"/></mask><use fill="#eee" xlink:href="#v"/><path fill="#F6F6F6" d="M244.77 102.24h600v50.4h-600zM244.77 172.8h500v37.44h-500zM244.77 233.28h704v38.185h-704zM28.8 315.36h990v33.12h-990z" mask="url(#w)"/><rect width="187.2" height="187.2" x="28.8" y="102.24" fill="#F6F6F6" mask="url(#w)" rx="6"/></g></g></svg>
        <Load v-if="nu!==1"></Load>    
        <header>
            <router-link to='/take' tag='h2'><</router-link>
            <dl>
                <dt><img src="../../image/16.png" alt=""></dt>
                <dd>
                    <h1>{{$route.params.name}}</h1>
                    <p>商家配送/分钟送达/配送费￥1</p>
                    <p>公告：{{$route.params.promotion_info}}</p>
                </dd>
            </dl>
            <h2><span>减</span>满30减5，满60减8（APP专享）<span>2个活动></span></h2>
            <ul id="a1">
                <li>商品</li>
                <li>评价</li>
            </ul>
        </header>
        <div class="notice"></div>
        <div class="goods">
            <div class="left" ref="left">
                <ul>
                    <li v-for="(item, index) in navs" 
                        :key="index" 
                        :class="{click: selector==index}"
                        @click="toHash(item, index)"
                        ><a :href="'#'+item.id">{{item.name}}</a></li>
                </ul>
            </div>
            <div class="right" @scroll="listScroll">
                <ul>
                    <li v-for="(good, index1) in navs" :key="index1" :id="good.name">
                        <h1 class="goodTitle"><a :name="good.id">{{good.name}}</a></h1>
                        <ul class="good">
                            <li v-for="(item, index2) in good.foods" :key="index2">
                                <dl>
                            <dt><img :src="'//elm.cangdu.org/img/'+item.image_path" alt=""></dt>
                            <dd>
                                <h2>{{item.name}}</h2>
                                <p>{{item.description}}</p>
                                <p>{{item.tips}}</p>
                                <p><span v-for="i in item.specfoods">￥{{i.price}}</span></p>
                            </dd>
                                </dl>
                                <div id="pop">        
                                    <div :class="{pop: true, mov: item.__v>0}">
                                        <i class="fa fa-fw fa-minus-circle" @click="reduce(index1, index2)"></i>
                                        {{item.__v}}
                                    </div>
                                    <i class="fa fa-fw fa-plus-circle" @click="increase(index1, index2, $event)"></i>
                                </div>
                            </li>
                        </ul>
                    </li> 
                </ul>
            </div>
        </div>

        <!-- 运动的小球 -->
        <div id="points">
            <div class="pointOuter pointPre">
                <div class="point-inner"></div>
            </div>  
            <div class="pointOuter pointPre">
                <div class="point-inner"></div>
            </div>  
            <div class="pointOuter pointPre">
                <div class="point-inner"></div>
            </div>  
            <div class="pointOuter pointPre">
                <div class="point-inner"></div>
            </div>  
            <div class="pointOuter pointPre">
                <div class="point-inner"></div>
            </div>  
            <div class="pointOuter pointPre">
                <div class="point-inner"></div>
            </div>  
            <div class="pointOuter pointPre">
                <div class="point-inner"></div>
            </div>  
        </div>
        
        <div class="footer">
            <div>
                <i class="fa fa-fw fa-shopping-cart"></i>
                <!--记录订单总数  -->
                <div class="total" v-show="total>0">{{total}}</div>
            </div>
            <div :class="{pay: true, notPay: total==0}">去结算</div>
        </div>
    </div>
    <!-- </div> -->
</template>

<script>
import axios from "axios";
// import betterScroll from "better-scroll";
import Load from '../../components/cheshi/aa.vue'
export default {
     components: {
    Load
  },
    data(){
        return{
        navs:'',
        selector: 0,
        goods:'',
        total: 0,  // 购买总量
        num:0,
        nu:1
        }
    },
    mounted() {
     this.nu=this.nu-1   
    this.axios
      .get(
        "http://elm.cangdu.org/shopping/v2/menu?restaurant_id="+ this.$route.params.id)
      .then(res => {
          this.nu=this.nu+1
        this.navs = res.data; //获取城市id
        console.log(this.navs)
      });


  },
    methods: {
        // 点击左侧导航栏
        toHash(item, index) {
            this.selector = index;//点击改变样式
            // window.location.hash = item;
            
            // 导航栏向上滚动相应距离，一个li的高度为54px
            this.$refs.left.scrollTop = (index > 7 ? index-7 : 0)*54;//左侧导航栏8个以后开始滚动
            
        },
        // 食品选购按钮
        increase(index1, index2, event) { 
            this.total++;
            this.navs[index1].foods[index2].__v++;

            // 小球动画 
            var top = event.clientY, // 小球降落起点
                left = event.clientX,
                endTop = window.innerHeight - 30,  // 小球降落终点
                endLeft = 20; 

            // // 小球到达起点
            var outer = $('#points .pointPre').first().removeClass("pointPre").css({
                left: left + 'px',
                top: top + 'px'
            });
            var inner = outer.find(".point-inner"); 
 
            setTimeout(function() { 
                // 将jquery对象转换为DOM对象
                outer[0].style.webkitTransform = 'translate3d(0,' + (endTop - top) + 'px,0)';
                inner[0].style.webkitTransform = 'translate3d(' + (endLeft - left) + 'px,0,0)';
                
                // 小球运动完毕恢复到原点
                setTimeout(function() {
                    outer.removeAttr("style").addClass("pointPre");
                    inner.removeAttr("style");
                }, 1000);  //这里的延迟值和小球的运动时间相关
            }, 1);
        },
        reduce(index1, index2) {
            this.total--;
            this.navs[index1].foods[index2].__v--;
        },
        // 右侧菜单滑动
        listScroll() {
            // 为了达到联动效果，右侧滑动则改变左侧导航栏样式
            var titles = document.getElementsByClassName('goodTitle');//获取标题
            for(var i = 0; i < titles.length; i++) {
                var style = titles[i].getBoundingClientRect();
                // console.log(style.top)
                if(style.top == 248) {
                    this.toHash(titles[i].innerHTML, i);
                    //  console.log("4567")
                }
            }
           
        }
    } 
}
</script>

<style lang='scss' scoped>
#el {
    position: sticky;
    top: 0;
}
*{
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-size: 16px;
}
body,html{
  width: 100%;
  height: 100%;
}
#app{
  width: 100%;
  display: flex; 
  flex-direction: column;
  position:relative;
 svg{
     height: 100%;
     position:fixed;
     left:0;
     bottom:0;
     z-index:100;
 }
 #lodal{
     z-index:105;
 }
  header{
      z-index: 99.9;
      width: 100%;
      height: 250px;
      background-color: #9c7fa6;
      dl{
           padding: 10px 15px 10px 15px;
          display: flex;
          dt{
              img{
                  width: 120px;
              }
          }
          dd{
              margin-left: 15px;
              h1{
                  font-size: 22px;
                  color: #ffffff;
              }
              p{
                  font-size: 18px;
                  margin-top: 15px;
                  color: #ffffff;
              }
          }
      }
      h2{
          padding-left: 10px;
              font-size: 18px;
              color: #ffffff;
              margin-top: 15px;
              span:nth-of-type(1){
                  font-size: 18px;
                  text-align: center;
                  width: 24px;
                  height: 24px;
                  display: inline-block;
                  background-color: #ef7475;
                  margin-right: 6px;
                  border-radius: 6px;
              }
               span:nth-of-type(2){
                margin-left: 15px;
               }
          }
          ul{
              margin-top: 15px;
              width: 100%;
              height: 55px;
              line-height: 55px;
              background-color: #fff;
              list-style: none;
              display: flex;
              padding-left: 100px;
              padding-right: 100px;
              justify-content: space-around;
              li{
                  font-size: 18px;
              }
          }
  }


li {
    list-style: none;
}
a {
    display: block;
    height: 100%;
    width: 100%;
    text-decoration: none;
    color: #000;
} 
.notice {
    height: 40px; 
}
.goods {
    display: flex;
    position: absolute;
    top: 246px;
    bottom: 46px;
    width: 100%;
    background-color: #eee;
    padding-top: 2px;
    /* overflow: hidden; */
}
.left {
    /* grow  shrink basis */
    flex: 0 0 80px;    
    width: 80px;
    background: #f3f5f7;
    overflow: scroll;
}  
.left>ul>li { 
    height: 54px;
    line-height: 54px;
    text-align: center;  
    border-bottom: 1px solid #ccc;
    box-sizing: border-box;
}    
.click {
    background-color: #fff;
}
.right {
    flex: 1;
    background-color: #fff;
    overflow: scroll;
} 
.right li h1 {
    padding-left: 5%;
    background-color: #f3f5f7;
    position: sticky;
    top: 0;
    z-index: 10;
    height: 45px;
    line-height: 45px;
}
.good {
    min-height: 300px;
    background-color: #fff;
    margin: 0 5%;
}
.good li {
    border-bottom: 1px solid #ccc; 
    height: 130px;
    font-size: 21px;
    // text-align: right; 
    display: flex;
    justify-content: space-between;
    overflow: hidden;
    dl{
                height: 130px;
                display: flex;
                padding-top: 13px;
                background-color: #fff;
                dt{
                    img{
                        width: 95px;
                    }
                }
                dd{
                    width: 130px;
                    margin-left:15px; 
                    text-align: left;
                    p{
                        margin-bottom: 7px;
                    }
                   p:nth-of-type(1){
                       color: #ccc;
                       font-size: 14px;
                   }
                    p:nth-of-type(2){
                       font-size: 14px;
                   }
                   p:nth-of-type(3){
                       color: red;
                       font-size: 14px;
                   }
                }
                }
    
} 
.good li i{
    font-size: 18px;
    line-height: 30px; 
    color: #00a0dc;
    padding: 0 4px;
}
/* 点击添加按钮缓慢弹出订单个数以及减少按钮 */
#pop{
    display: flex;
}
.pop {
    display: inline-block;
    position: relative;
    left: 0px;
    opacity: 0;
    transition: all ease .5s;
}
.pop i {
    transform: rotate(0deg); 
    transition: all ease .5s;
}
.mov {
    left: 0;
    opacity: 1;
}
.pop.mov i {
    transform: rotate(-360deg);
}
.good li>div>i {
    position: relative; 
    background-color: #fff;
    z-index: 5;
} 




.footer {
    // z-index: 99;
    background-color: #555;
    width: 100%;
    height: 55px;
    line-height: 55px;
    bottom: 0;
    position: fixed;
    font-size: 45px;
    padding-left: 10px;
    display: flex;
    justify-content: space-between;
    box-sizing: border-box;
}
.footer i {
    font-size: 35px;
    color: #00a0dc;
}
.footer .total {
    position: absolute;
    width: 20px;
    height: 20px;
    top: 0px;
    left: 46px;
    color: #fff;
    line-height: 20px;
    text-align: center;
    border-radius: 10px;
    background-color: #00a0dc;
    font-size: 10px;
}
.pay {
    /* background-color: rgb(78, 207, 45); */
    background-color: #00a0dc;
    color: #fff;
    font-size: 18px;
    padding: 0 20px;
}
.notPay {
    background-color: #bbb;
}

/* 运动小球 */
.pointPre {  /* 动画的小球 */
    display: none;
}
.pointOuter {
    position: absolute;  
    z-index: 114;  
    /* 当小球抛出时遵循贝塞尔曲线过渡 */
    -webkit-transition: all 1s cubic-bezier(0.39,-0.4,0.83,0.23) 0s;
    transition: all 1s cubic-bezier(0.39,-0.4,0.83,0.23) 0s; 
}

.point-inner {
    width: 15px;
    height: 15px;
    border-radius: 50%;
    background-color: #00a0dc;
    /* 过渡属性名称 过渡时间 过渡曲线 延迟时间 */
    transition: all 1s ease 0s;
    -webkit-transition: all 1s ease 0s;     
} 
} 
</style>
